Object subclass: #Cart	instanceVariableNames: 'items catalog'	classVariableNames: ''	poolDictionaries: ''	category: 'TusLibros'!!Cart methodsFor: 'adding' stamp: 'mg 10/30/2017 18:08'!contains: aBook	catalog indexOf: aBook ifAbsent: [ ^ false ].	^ true .! !!Cart methodsFor: 'adding' stamp: 'mg 10/30/2017 18:13'!initializeWith: aCatalog	catalog := aCatalog .	items := Dictionary new.! !!Cart methodsFor: 'adding' stamp: 'mg 10/26/2017 21:15'!numberOfProducts	| quantity |	quantity := 0 .	items valuesDo: [ :aBookQuantity | quantity := quantity + aBookQuantity ] .	^ quantity .! !!Cart methodsFor: 'adding' stamp: 'mg 10/30/2017 18:15'!add: aBook quantity: aQuantity	(self contains: aBook) ifFalse: [ self error: Cart bookNotInCatalog ] .		items add: (Association key: aBook value: aQuantity ) .	! !!Cart methodsFor: 'adding' stamp: 'mg 10/30/2017 18:23'!numberOfProduct: aProduct	^ items at: aProduct  .! !!Cart methodsFor: 'testing' stamp: 'mg 11/1/2017 21:35'!isEmpty	^ self numberOfProducts = 0 .! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Cart class	instanceVariableNames: ''!!Cart class methodsFor: 'instance creation' stamp: 'mg 10/26/2017 20:30'!withCatalog: aCatalog	^super new initializeWith: aCatalog  .! !!Cart class methodsFor: 'instance creation' stamp: 'mg 10/26/2017 20:39'!bookNotInCatalog	^ 'El producto no está en el catálogo' .! !Object subclass: #Cashier	instanceVariableNames: 'cart creditCard date salesBook'	classVariableNames: ''	poolDictionaries: ''	category: 'TusLibros'!!Cashier methodsFor: 'initialization' stamp: 'mg 11/1/2017 21:03'!initializeFor: aCart debit: aCreditCard at: aDate registerOn: aSalesBook 	cart := aCart .	creditCard := aCreditCard .	date := aDate .	salesBook := aSalesBook .! !!Cashier methodsFor: 'operations' stamp: 'mg 11/1/2017 22:10'!salesQuantity	^ salesBook size .	! !!Cashier methodsFor: 'operations' stamp: 'mg 11/1/2017 20:49'!checkout	cart numberOfProducts = 0 ifTrue: [ ^ self error: Cashier cartIsEmpty  ].	(creditCard isExpiredAt: (Date today)) ifTrue: [ ^ self error: Cashier creditCardIsOutdated ].	! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Cashier class	instanceVariableNames: ''!!Cashier class methodsFor: 'as yet unclassified' stamp: 'mg 10/30/2017 19:17'!creditCardIsOutdated	^ 'Credit card is outdated'.! !!Cashier class methodsFor: 'as yet unclassified' stamp: 'mg 10/30/2017 20:51'!charge: aCart debit: aCreditCard at: aDate registerOn: aSalesBook		^ (super new) initializeFor: aCart debit: aCreditCard at: aDate registerOn: aSalesBook . ! !!Cashier class methodsFor: 'as yet unclassified' stamp: 'mg 10/30/2017 18:47'!cartIsEmpty	^ 'Cart is empty'.! !Object subclass: #CreditCard	instanceVariableNames: 'number expirationDate balance'	classVariableNames: ''	poolDictionaries: ''	category: 'TusLibros'!!CreditCard methodsFor: 'testing' stamp: 'mg 11/1/2017 21:00'!isExpiredAt: aDate	^ expirationDate < aDate .! !!CreditCard methodsFor: 'initialization' stamp: 'mg 11/1/2017 21:50'!initializeFor: aNumber validTo: anExpirationDate withLimit: anAmount		number := aNumber .	expirationDate := anExpirationDate .	balance := anAmount .! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!CreditCard class	instanceVariableNames: ''!!CreditCard class methodsFor: 'as yet unclassified' stamp: 'mg 11/1/2017 21:51'!with: aNumber validTo: anExpirationDate withLimit: anAmount	^ (super new) initializeFor: aNumber validTo: anExpirationDate withLimit: anAmount .! !Object subclass: #SupervisedMerchantProcessor	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'TusLibros'!!SupervisedMerchantProcessor methodsFor: 'as yet unclassified' stamp: 'mg 11/1/2017 22:07'!debitWithCreditCardNumber: aCardNumber creditCardExpiration: anExpiration creditCardOwner: anOwner amount: anAmount 	^ true .! !Object subclass: #TestObjectsFactory	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'TusLibros'!"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!TestObjectsFactory class	instanceVariableNames: ''!!TestObjectsFactory class methodsFor: 'tests' stamp: 'mg 11/1/2017 21:38'!aValidCreditCard	^ CreditCard with: '5400 1234 5678 9999' validTo: Date today withLimit: 1000.! !!TestObjectsFactory class methodsFor: 'tests' stamp: 'mg 11/1/2017 21:40'!areditCardWithoutBalance	^ CreditCard with: '5400 1234 5678 9999' validTo: Date yesterday withLimit: 0.! !!TestObjectsFactory class methodsFor: 'tests' stamp: 'mg 11/1/2017 21:38'!anOutdatedCreditCard	^ CreditCard with: '5400 1234 5678 9999' validTo: Date yesterday withLimit: 1000.! !TestCase subclass: #TusLibrosTests	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'TusLibros'!!TusLibrosTests methodsFor: 'tests' stamp: 'mg 10/30/2017 18:21'!test04addMultipleValidBooks	| aCart aBook otherBook aQuantity otherQuantity aCatalog |		aBook := #book123.	otherBook := #book456.	aCatalog := OrderedCollection with: aBook with: otherBook .	aCart := Cart withCatalog: aCatalog .	aQuantity := 2 .	otherQuantity := 5.		aCart add: aBook quantity: aQuantity .	aCart add: otherBook  quantity: otherQuantity .		self assert: aCart numberOfProducts equals: (aQuantity + otherQuantity ) .	self assert: (aCart numberOfProduct: aBook) equals: aQuantity .	self assert: (aCart numberOfProduct: otherBook ) equals: otherQuantity  .! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/1/2017 21:35'!test02AddProductMakesNonEmptyCart	| aCart aBook aQuantity aCatalog |	aBook := #book123.	aCatalog := OrderedCollection with: aBook .	aCart := Cart withCatalog: aCatalog.	aQuantity := 2 .	aCart add: aBook quantity: aQuantity .		self deny: aCart isEmpty .	self assert: aCart numberOfProducts equals: aQuantity .! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/1/2017 22:11'!test07CannotCheckoutWithACreditCardWithoutFunds	| aCatalog aCart aCreditCard aSalesBook aCashier aBook aQuantity |		aBook := #book123.	aQuantity := 2 .	aCatalog := OrderedCollection new .	aCatalog add: aBook .	aCart := Cart withCatalog: aCatalog .	aCreditCard :=  TestObjectsFactory anOutdatedCreditCard.	aSalesBook := OrderedCollection new .			aCart add: aBook quantity: aQuantity .		aCashier := Cashier charge: aCart debit: aCreditCard at: (Date today) registerOn: aSalesBook .		self
		should: [ aCashier checkout ]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: Cashier creditCardIsOutdated .			self deny: aCart isEmpty .			self assert: aCashier salesQuantity equals: 0 . ]	! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/1/2017 22:10'!test06CannotCheckoutOutdatedCreditCard	| aCatalog aCart aCreditCard aSalesBook aCashier aBook aQuantity |		aBook := #book123.	aQuantity := 2 .	aCatalog := OrderedCollection new .	aCatalog add: aBook .	aCart := Cart withCatalog: aCatalog .	aCreditCard :=  TestObjectsFactory anOutdatedCreditCard.	aSalesBook := OrderedCollection new .			aCart add: aBook quantity: aQuantity .		aCashier := Cashier charge: aCart debit: aCreditCard at: (Date today) registerOn: aSalesBook .		self
		should: [ aCashier checkout ]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: Cashier creditCardIsOutdated .			self deny: aCart isEmpty . 			self assert: aCashier salesQuantity equals: 0 . ]	! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/1/2017 21:36'!test03CannotAddProductThatIsNotFromThisEditorial	| aCart aBook aQuantity aCatalog |		aBook := #book123.	aCatalog := OrderedCollection new .	aCart := Cart withCatalog: aCatalog .	aQuantity := 2 .		self
		should: [ aCart add: aBook quantity: aQuantity ]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cart bookNotInCatalog .			self assert: aCart isEmpty  ]! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/1/2017 21:35'!test01NewCartIsEmpty	| aCart aCatalog |	aCatalog := OrderedCollection new .	aCart := Cart withCatalog: aCatalog .		self assert: aCart isEmpty .! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/1/2017 22:11'!test05CannotCheckoutEmptyCart	| aCart aCatalog aCashier aCreditCard aSalesBook |		aCatalog := OrderedCollection new .	aCart := Cart withCatalog: aCatalog .	aCreditCard :=  TestObjectsFactory aValidCreditCard.	aSalesBook := OrderedCollection new .	aCashier := Cashier charge: aCart debit: aCreditCard at: (Date today) registerOn: aSalesBook .			self
		should: [ aCashier checkout]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: Cashier cartIsEmpty .			self assert: aCart isEmpty .			self assert: aCashier salesQuantity equals: 0 . ]	! !