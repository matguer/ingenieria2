Object subclass: #Cart	instanceVariableNames: 'items catalog'	classVariableNames: ''	poolDictionaries: ''	category: 'TusLibros'!!Cart methodsFor: 'adding' stamp: 'mg 11/5/2017 17:29'!withProductsAndQuantitiesDo: aClosure	items copy keysAndValuesDo: aClosure .! !!Cart methodsFor: 'adding' stamp: 'mg 11/5/2017 15:06'!summarize	| total |	total := 0 .	items keysAndValuesDo: [ :aBook :aQuantity | total := total + ((catalog at: aBook) * aQuantity) ] .	^ total . ! !!Cart methodsFor: 'adding' stamp: 'Guerson 11/5/2017 13:22'!isEmpty	^ (self numberOfProducts) = 0 .! !!Cart methodsFor: 'adding' stamp: 'mg 11/5/2017 15:11'!contains: aBook	catalog at: aBook ifAbsent: [ ^ false ].	^ true .! !!Cart methodsFor: 'adding' stamp: 'mg 11/6/2017 13:47'!add: aBook quantity: aQuantity	aQuantity < 1 ifTrue: [ ^ self error: Cart invalidQuantity ].	(self contains: aBook) ifFalse: [ self error: Cart bookNotInCatalog ] .		items add: (Association key: aBook value: aQuantity ) .	! !!Cart methodsFor: 'adding' stamp: 'mg 10/30/2017 18:13'!initializeWith: aCatalog	catalog := aCatalog .	items := Dictionary new.! !!Cart methodsFor: 'adding' stamp: 'mg 10/30/2017 18:23'!numberOfProduct: aProduct	^ items at: aProduct  .! !!Cart methodsFor: 'adding' stamp: 'mg 10/26/2017 21:15'!numberOfProducts	| quantity |	quantity := 0 .	items valuesDo: [ :aBookQuantity | quantity := quantity + aBookQuantity ] .	^ quantity .! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Cart class	instanceVariableNames: ''!!Cart class methodsFor: 'instance creation' stamp: 'mg 10/26/2017 20:39'!bookNotInCatalog	^ 'El producto no está en el catálogo' .! !!Cart class methodsFor: 'instance creation' stamp: 'mg 11/6/2017 13:45'!invalidQuantity	^ 'La cantidad de productos a agregar debe ser mayor o igual a 1' .! !!Cart class methodsFor: 'instance creation' stamp: 'mg 10/26/2017 20:30'!withCatalog: aCatalog	^super new initializeWith: aCatalog  .! !Object subclass: #Cashier	instanceVariableNames: 'cart creditCard date salesBook merchantProcessor'	classVariableNames: ''	poolDictionaries: ''	category: 'TusLibros'!!Cashier methodsFor: 'initialization' stamp: 'mg 11/5/2017 14:58'!initializeFor: aCart debit: aCreditCard at: aDate registerOn: aSalesBook merchant: aMerchantProcessorClosure	cart := aCart .	creditCard :=aCreditCard .	date := aDate .	salesBook := aSalesBook .	merchantProcessor := aMerchantProcessorClosure .! !!Cashier methodsFor: 'operations' stamp: 'mg 11/5/2017 16:03'!checkout	| transactionId aSale |	cart numberOfProducts = 0 ifTrue: [ ^ self error: Cashier cartIsEmpty  ].	(creditCard isExpiredAt: (Date current) ) ifTrue: [ ^ self error: Cashier creditCardIsOutdated ].	transactionId := merchantProcessor value: cart summarize value: creditCard .	aSale := Sale with: cart at: date transaction: transactionId.	salesBook add: aSale.	^ aSale .! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Cashier class	instanceVariableNames: ''!!Cashier class methodsFor: 'as yet unclassified' stamp: 'mg 10/30/2017 18:47'!cartIsEmpty	^ 'Cart is empty'.! !!Cashier class methodsFor: 'as yet unclassified' stamp: 'mg 11/5/2017 14:59'!charge: aCart debit: aCreditCard at: aDate registerOn: aSalesBook merchant: aMerchantProcessorClosure		^ (super new) initializeFor: aCart debit: aCreditCard at: aDate registerOn: aSalesBook merchant: aMerchantProcessorClosure . ! !!Cashier class methodsFor: 'as yet unclassified' stamp: 'mg 10/30/2017 19:17'!creditCardIsOutdated	^ 'Credit card is outdated'.! !Object subclass: #CreditCard	instanceVariableNames: 'validDate ccn number expirationDate'	classVariableNames: ''	poolDictionaries: ''	category: 'TusLibros'!!CreditCard methodsFor: 'initialization' stamp: 'Guerson 11/5/2017 13:08'!initializeWithNumber: aNumber validTo: anExpirationDate	number := aNumber .	expirationDate := anExpirationDate .! !!CreditCard methodsFor: 'initialization' stamp: 'Guerson 11/5/2017 13:21'!isExpiredAt: aDate	^ expirationDate < aDate .! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!CreditCard class	instanceVariableNames: ''!!CreditCard class methodsFor: 'as yet unclassified' stamp: 'Guerson 11/5/2017 13:09'!withNumber: aNumber validTo: anExpirationDate	^ super new initializeWithNumber: aNumber validTo: anExpirationDate .! !Object subclass: #Interface	instanceVariableNames: 'clients catalog sessions sessionTimeoutInSeconds'	classVariableNames: ''	poolDictionaries: ''	category: 'TusLibros'!!Interface methodsFor: 'initialization' stamp: 'mg 11/6/2017 15:38'!initializeWwithClients: theClients catalog: aCatalog sessionExpirationTimeInSeconds: aSessionExpirationTime	sessions := Dictionary new .	sessionTimeoutInSeconds := aSessionExpirationTime .	clients := theClients .	catalog := aCatalog .	sessions  := Dictionary new .! !!Interface methodsFor: 'adding' stamp: 'mg 11/6/2017 14:12'!validSession: aClient		! !!Interface methodsFor: 'adding' stamp: 'mg 11/6/2017 15:53'!addToCart: aCartId book: aBook quantity: aQuantity	| aCart session |	session := sessions at: aCartId ifAbsent: [ ^ self error: Interface inexistentCartError ]. 	aCart := session cart .	session ifExpiredAt: (DateAndTime current) do: [ ^ self error: Session expiredSession ].	aCart add: aBook quantity: aQuantity .	! !!Interface methodsFor: 'as yet unclassified' stamp: 'mg 11/6/2017 15:52'!listProducts: aCartId	| aCart products session |	session := sessions at: aCartId ifAbsent: [ ^ self error: Interface inexistentCartError ]. 	aCart := session cart .	session ifExpiredAt: (DateAndTime current) do: [ ^ self error: Session expiredSession ].	products := Dictionary new .	aCart withProductsAndQuantitiesDo: [ :aProduct :aQuantity | products add: (Association key: aProduct value: aQuantity ) ] .	^ products .	! !!Interface methodsFor: 'as yet unclassified' stamp: 'mg 11/6/2017 15:38'!createCartFor: aUser password: aPassword	| aClientPassword aCart aCartId |	aClientPassword := clients at: aUser ifAbsent: [ ^ self error: Interface inexistentUserError ] .	aClientPassword = aPassword ifFalse: [ ^ self error: Interface wrongPasswordError ] .	aCart := Cart withCatalog: catalog .	aCartId := self generateCartId .	sessions add: (Association key: aCartId value: (Session for: aUser with: aCart id: aCartId ttl: sessionTimeoutInSeconds)).	^ aCartId .! !!Interface methodsFor: 'as yet unclassified' stamp: 'mg 11/5/2017 17:19'!generateCartId	^ UUIDGenerator default next . ! !!Interface methodsFor: 'as yet unclassified' stamp: 'mg 11/6/2017 15:53'!checkOutCart: aCartId ccn: aCCNumber cced: anCCExpirationDate cco: aCCOwner	| aCart session |	session := sessions at: aCartId ifAbsent: [ ^ self error: Interface inexistentCartError ]. 	aCart := session cart .	session ifExpiredAt: (DateAndTime current) do: [ ^ self error: Session expiredSession ].	! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Interface class	instanceVariableNames: ''!!Interface class methodsFor: 'as yet unclassified' stamp: 'mg 11/5/2017 16:56'!wrongPasswordError	^ 'Contraseña errónea' .! !!Interface class methodsFor: 'as yet unclassified' stamp: 'mg 11/5/2017 17:24'!inexistentCartError	^ 'Carrito inexistente' .! !!Interface class methodsFor: 'as yet unclassified' stamp: 'mg 11/6/2017 15:39'!withClients: clients catalog: aCatalog sessionExpirationTimeInSeconds: aSessionExpirationTime	^ super new initializeWwithClients: clients catalog: aCatalog sessionExpirationTimeInSeconds: aSessionExpirationTime .	! !!Interface class methodsFor: 'as yet unclassified' stamp: 'mg 11/6/2017 14:58'!expiredSession	^ 'Sesión expirada' .! !!Interface class methodsFor: 'as yet unclassified' stamp: 'mg 11/5/2017 16:49'!inexistentUserError	^ 'Usuario inexistente' .! !Object subclass: #Sale	instanceVariableNames: 'cart transaction date'	classVariableNames: ''	poolDictionaries: ''	category: 'TusLibros'!!Sale methodsFor: 'initialization' stamp: 'mg 11/5/2017 16:10'!date	^ date.! !!Sale methodsFor: 'initialization' stamp: 'mg 11/5/2017 16:07'!initializeWith: aCart at: aDate transaction: aTransaction	cart := aCart.	date := aDate.	transaction := aTransaction.! !!Sale methodsFor: 'initialization' stamp: 'mg 11/5/2017 16:10'!transaction	^ transaction .! !!Sale methodsFor: 'initialization' stamp: 'mg 11/5/2017 16:10'!cart	^ cart.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Sale class	instanceVariableNames: ''!!Sale class methodsFor: 'as yet unclassified' stamp: 'mg 11/5/2017 16:06'!with: aCart at: aDate transaction: aTransaction	^ super new initializeWith: aCart at: aDate transaction: aTransaction . ! !Object subclass: #Session	instanceVariableNames: 'cartId client cart lastActivity ttl'	classVariableNames: ''	poolDictionaries: ''	category: 'TusLibros'!!Session methodsFor: 'initialization' stamp: 'mg 11/6/2017 15:22'!cartId	^ cartId.! !!Session methodsFor: 'initialization' stamp: 'mg 11/6/2017 15:22'!cart	^ cart.! !!Session methodsFor: 'initialization' stamp: 'mg 11/6/2017 15:39'!initializeFor: aUser with: aCart id: aCartId ttl: sessionTimeoutInSeconds	client := aUser .	cart := aCart .	cartId := aCartId .	lastActivity := DateAndTime current .	ttl := sessionTimeoutInSeconds.! !!Session methodsFor: 'initialization' stamp: 'mg 11/6/2017 15:40'!ifExpiredAt: aGivenTime do: aBlock	(((lastActivity asSeconds)  - (aGivenTime asSeconds)) >= ttl) ifTrue: [aBlock value].! !!Session methodsFor: 'initialization' stamp: 'mg 11/6/2017 15:22'!lastActivity	^ lastActivity .! !!Session methodsFor: 'initialization' stamp: 'mg 11/6/2017 15:22'!client	^ client.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Session class	instanceVariableNames: ''!!Session class methodsFor: 'as yet unclassified' stamp: 'mg 11/6/2017 15:44'!for: aUser with: aCart id: aCartId ttl: sessionTimeoutInSeconds	^ super new initializeFor: aUser with: aCart id: aCartId ttl: sessionTimeoutInSeconds.! !!Session class methodsFor: 'as yet unclassified' stamp: 'mg 11/6/2017 15:33'!expiredSession	^ 'Sesión expirada' .! !TestCase subclass: #TusLibrosTests	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'TusLibros'!!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 14:05'!sessionDefaultTimeOutInMillis	^ 30*60*1000 .! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/5/2017 14:57'!stolenCreditCardError	^ 'Tarjeta de crédito robada'! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 15:41'!test14InterfaceCreatesCartForAnExistentClient		| anInterface clients aClient aPassword aCartId |	clients := Dictionary new .	aClient := 'client1' .	aPassword := 'aPassword' .	clients add: (Association key: aClient value: aPassword ) .	anInterface := Interface withClients: clients catalog: Dictionary new sessionExpirationTimeInSeconds: self sessionDefaultTimeOutInSeconds . 		aCartId := anInterface createCartFor: aClient password: aPassword .	self assert: (anInterface listProducts: aCartId) isEmpty.! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 13:43'!test06CannotCheckoutEmptyCart	| aCart aCatalog aCashier aCreditCard aSalesBook |		aCatalog := Dictionary new .	aCart := Cart withCatalog: aCatalog .	aCreditCard :=  self aValidCreditCard.	aSalesBook := OrderedCollection new .	aCashier := Cashier charge: aCart debit: aCreditCard at: (Date today) registerOn: aSalesBook merchant: [  ] .		self
		should: [ aCashier checkout]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cashier cartIsEmpty .			self assert: aCart isEmpty . 			self assert: aSalesBook isEmpty . ]	! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 13:44'!test05addMultipleValidBooks	| aCart aBook otherBook aQuantity otherQuantity aCatalog aPrice otherPrice |		aBook := #book123.	otherBook := #book456.	aPrice := 20 .	otherPrice := 30 .	aCatalog := Dictionary new .	aCatalog add: (Association key: aBook value: aPrice ) .	aCatalog add: (Association key: otherBook value: otherPrice ) .	aCart := Cart withCatalog: aCatalog .	aQuantity := 2 .	otherQuantity := 5.		aCart add: aBook quantity: aQuantity .	aCart add: otherBook  quantity: otherQuantity .		self assert: aCart numberOfProducts equals: (aQuantity + otherQuantity ) .	self assert: (aCart numberOfProduct: aBook) equals: aQuantity .	self assert: (aCart numberOfProduct: otherBook ) equals: otherQuantity  .! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 15:42'!test15InterfaceCreatesCartsForMultipleClients		| anInterface clients aClient aPassword aCartId otherClient otherPassword otherCartId |		clients := Dictionary new .	aClient := 'client1' .	aPassword := 'password1' .	otherClient := 'client2' .	otherPassword := 'password2' .	clients add: (Association key: aClient value: aPassword ) .	clients add: (Association key: otherClient value: otherPassword ) .		anInterface := Interface withClients: clients catalog: Dictionary new sessionExpirationTimeInSeconds: self sessionDefaultTimeOutInSeconds . 		aCartId := anInterface createCartFor: aClient password: aPassword .	otherCartId := anInterface createCartFor: otherClient password: otherPassword .		self assert: (anInterface listProducts: aCartId) isEmpty.	self assert: (anInterface listProducts: otherCartId) isEmpty.! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 13:43'!test09CannotCheckoutWithACreditCardWithoutFunds| aBook aCart aCatalog aCashier aCreditCard aSalesBook aQuantity aMerchantProcessor aPrice |		aBook := #book123.	aQuantity := 2 .	aPrice := 20 .	aCatalog := Dictionary new .	aCatalog add: (Association key: aBook value: aPrice ) .	aCart := Cart withCatalog: aCatalog .	aCart add: aBook quantity: aQuantity .	aCreditCard :=  self aValidCreditCard .	aSalesBook := OrderedCollection new .	aMerchantProcessor := [ :anAmount :aCC | self error: self creditCardErrorWithoutFunds ] .	aCashier := Cashier charge: aCart debit: aCreditCard at: (Date today) registerOn: aSalesBook merchant: aMerchantProcessor.	self
		should: [ aCashier checkout]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText = self creditCardErrorWithoutFunds .			self assert: aCart numberOfProducts = aQuantity . 			self assert: aSalesBook isEmpty . ]! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 15:41'!test12InterfaceCantCreateCartForInexistentClient		| anInterface |	anInterface := Interface withClients: (Dictionary new) catalog: (Dictionary new) sessionExpirationTimeInSeconds: self sessionDefaultTimeOutInSeconds . 		self
		should: [ anInterface createCartFor: 'user' password: 'password' ]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText = Interface inexistentUserError ]! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 15:55'!test18InterfaceCannotOperateWithExpiredSession		| anInterface clients aClient aPassword aCartId |		clients := Dictionary new .		aClient := 'client1' .	aPassword := 'password1' .	clients add: (Association key: aClient value: aPassword ) .	anInterface := Interface withClients: clients catalog: Dictionary new sessionExpirationTimeInSeconds: 0  . 		aCartId := anInterface createCartFor: aClient password: aPassword .		self
		should: [ anInterface listProducts: aCartId ]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText = Interface expiredSession ] .			self
		should: [ anInterface addToCart: aCartId book: #book123 quantity: 1 ]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText = Interface expiredSession ] .			self
		should: [ anInterface checkOutCart: aCartId ccn: '' cced: '' cco: '' ]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText = Interface expiredSession ] .! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 13:43'!test07CannotCheckoutOutdatedCreditCard| aBook aCart aCatalog aCashier aCreditCard aSalesBook aQuantity aPrice |		aBook := #book123.	aQuantity := 2 .	aPrice := 20 .	aCatalog := Dictionary new .	aCatalog add: (Association key: aBook value: aPrice ) .	aCart := Cart withCatalog: aCatalog .	aCart add: aBook quantity: aQuantity .	aCreditCard :=  self anOutdatedCreditCard .	aSalesBook := OrderedCollection new .	aCashier := Cashier charge: aCart debit: aCreditCard at: (Date today) registerOn: aSalesBook merchant: [  ] .		self
		should: [ aCashier checkout]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cashier creditCardIsOutdated .			self assert: aCart numberOfProducts = aQuantity . 			self assert: aSalesBook isEmpty . ]! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 13:43'!test11CheckoutMoreThanOneItemIsRegisteredCorrectly| aBook aCart aCatalog aCashier aCreditCard aSalesBook aQuantity aMerchantProcessor aPrice aSalesDate aSalesRegister otherBook otherQuantity otherPrice |		aBook := #book123.	otherBook := #book456.	aQuantity := 2 .	aPrice := 20 .	otherQuantity := 6 .	otherPrice := 40 .	aCatalog := Dictionary new .	aCatalog add: (Association key: aBook value: aPrice ) .	aCatalog add: (Association key: otherBook value: otherPrice ) .	aCart := Cart withCatalog: aCatalog .	aCart add: aBook quantity: aQuantity .	aCart add: otherBook quantity: otherQuantity .	aCreditCard :=  self aValidCreditCard .	aSalesBook := OrderedCollection new .	aSalesDate := Date today.	aMerchantProcessor := [ :anAmount :aCC | ^ 123456 ] .		aCashier := Cashier charge: aCart debit: aCreditCard at: aSalesDate registerOn: aSalesBook merchant: aMerchantProcessor.	aSalesRegister := aCashier checkout.		self assert: (aSalesBook includes: aSalesRegister) .	self assert: aSalesRegister date equals: aSalesDate . 	self assert: aSalesRegister amount equals: (aCart summarize) . 	self assert: aSalesRegister transaction equals: 123456 . ! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/5/2017 15:19'!creditCardErrorWithoutFunds	^ 'Tarjeta de crédito sin fondos'! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 13:43'!test10CheckoutOneItemIsRegisteredCorrectly| aBook aCart aCatalog aCashier aCreditCard aSalesBook aQuantity aMerchantProcessor aPrice aSalesDate aSalesRegister |		aBook := #book123.	aQuantity := 2 .	aPrice := 20 .	aCatalog := Dictionary new .	aCatalog add: (Association key: aBook value: aPrice ) .	aCart := Cart withCatalog: aCatalog .	aCart add: aBook quantity: aQuantity .	aCreditCard :=  self aValidCreditCard .	aSalesBook := OrderedCollection new .	aSalesDate := Date today.	aMerchantProcessor := [ :anAmount :aCC | ^ 123456 ] .		aCashier := Cashier charge: aCart debit: aCreditCard at: aSalesDate registerOn: aSalesBook merchant: aMerchantProcessor.	aSalesRegister := aCashier checkout.		self assert: (aSalesBook includes: aSalesRegister) .	self assert: aSalesRegister date equals: aSalesDate . 	self assert: aSalesRegister amount equals: (aCart summarize) . 	self assert: aSalesRegister transaction equals: 123456 . ! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 13:43'!test08CannotCheckoutStolenCreditCard| aBook aCart aCatalog aCashier aCreditCard aSalesBook aQuantity aMerchantProcessor aPrice |		aBook := #book123.	aQuantity := 2 .	aPrice := 20 .	aCatalog := Dictionary new .	aCatalog add: (Association key: aBook value: aPrice ) .	aCart := Cart withCatalog: aCatalog .	aCart add: aBook quantity: aQuantity .	aCreditCard :=  self aValidCreditCard .	aSalesBook := OrderedCollection new .	aMerchantProcessor := [ :anAmount :aCC | self error: self stolenCreditCardError ] .	aCashier := Cashier charge: aCart debit: aCreditCard at: (Date today) registerOn: aSalesBook merchant: aMerchantProcessor.	self
		should: [ aCashier checkout]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText = self stolenCreditCardError .			self assert: aCart numberOfProducts = aQuantity . 			self assert: aSalesBook isEmpty . ]! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 15:41'!sessionDefaultTimeOutInSeconds	^ 30*60 .! !!TusLibrosTests methodsFor: 'tests' stamp: 'Guerson 11/5/2017 13:10'!anOutdatedCreditCard	^ CreditCard withNumber: '5400 1234 5678 9999' validTo: Date yesterday.! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 15:41'!test13InterfaceCantCreateCartForInvalidPassword		| anInterface clients |	clients := Dictionary new .	clients add: (Association key: 'client1' value: 'password1' ) .	anInterface := Interface withClients: clients catalog: Dictionary new sessionExpirationTimeInSeconds: self sessionDefaultTimeOutInSeconds .		self
		should: [ anInterface createCartFor: 'client1' password: 'wrongPassword' ]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText = Interface wrongPasswordError ]! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 15:42'!test16InterfaceCanHandleMultipleCartsPerClient		| anInterface clients aClient aPassword aCartId otherCartId |		clients := Dictionary new .	aClient := 'client1' .	aPassword := 'password1' .	clients add: (Association key: aClient value: aPassword ) .		anInterface := Interface withClients: clients catalog: Dictionary new sessionExpirationTimeInSeconds: self sessionDefaultTimeOutInSeconds . 		aCartId := anInterface createCartFor: aClient password: aPassword .	otherCartId := anInterface createCartFor: aClient password: aPassword .		self assert: (anInterface listProducts: aCartId) isEmpty.	self assert: (anInterface listProducts: otherCartId) isEmpty.! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/5/2017 15:10'!test02AddProductMakesNonEmptyCart	| aCart aBook aQuantity aCatalog aPrice |	aBook := #book123.	aPrice := 20 .	aCatalog := Dictionary new .	aCatalog add: (Association key: aBook value: aPrice ) .	aCart := Cart withCatalog: aCatalog.	aQuantity := 2 .	aCart add: aBook quantity: aQuantity .		self deny: aCart numberOfProducts = 0.	self assert: aCart numberOfProducts equals: aQuantity .! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/5/2017 15:07'!test01NewCartIsEmpty	| aCart aCatalog |	aCatalog := Dictionary new .	aCart := Cart withCatalog: aCatalog .		self assert: aCart isEmpty .! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 13:46'!test04CannotAddLessThanOneProduct	| aCart aBook aQuantity aCatalog aPrice |	aBook := #book123.	aPrice := 20 .	aCatalog := Dictionary new .	aCatalog add: (Association key: aBook value: aPrice ) .	aCart := Cart withCatalog: aCatalog.	aQuantity := 0 .		self
		should: [ aCart add: aBook quantity: aQuantity ]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cart invalidQuantity ]! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/5/2017 15:13'!test03CannotAddProductThatIsNotFromThisEditorial	| aCart aBook aQuantity aCatalog |		aBook := #book123.	aCatalog := Dictionary new .	aCart := Cart withCatalog: aCatalog .	aQuantity := 2 .		self
		should: [ aCart add: aBook quantity: aQuantity ]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cart bookNotInCatalog ]! !!TusLibrosTests methodsFor: 'tests' stamp: 'Guerson 11/5/2017 13:09'!aValidCreditCard	^ CreditCard withNumber: '5400 1234 5678 9999' validTo: Date today.! !!TusLibrosTests methodsFor: 'tests' stamp: 'mg 11/6/2017 15:42'!test17InterfaceCannotOperateWithInexistentCartId		| anInterface clients inexistentCartId |		clients := Dictionary new .		anInterface := Interface withClients: clients catalog: Dictionary new sessionExpirationTimeInSeconds: self sessionDefaultTimeOutInSeconds . 	inexistentCartId := 'inexistent' .		self
		should: [ anInterface listProducts: inexistentCartId ]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText = Interface inexistentCartError ] .			self
		should: [ anInterface addToCart: inexistentCartId book: '' quantity: 1 ]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText = Interface inexistentCartError ] .			self
		should: [ anInterface checkOutCart: inexistentCartId ccn: '' cced: '' cco: '' ]
		raise: Error 
		withExceptionDo: [ :anError |
			self assert: anError messageText = Interface inexistentCartError ] .! !